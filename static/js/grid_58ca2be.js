"use strict";var $group_dialog,$grid_container,$top_container,$add_grid,$group_list;template.on("isThumbImge",function(e){return"string"==typeof e&&e.startWith("mx://thumbs/")?!0:!1});var grid={hot_grid_html:'<li class="top grid">                    <% if(!!this.image) {%>                        <a href="<%= this.url || "" %>" target="_blank" class="thumb" style="background-image:url(<%= this.image %>);">                        </a>                    <% } else { %>                        <a href="<%= this.url || "" %>" %>" target="_blank">                            <div colorBlock="<%=this.colorBlock || "" %>" class="color-block <%=this.colorBlock || "" %>">                                <%=this.title ? this.title.substring(0, 1) : "" %>                            </div>                        </a>                    <% } %>                    </li>',grid_html:'<li class="main grid">                    <a href="<%= this.url || "" %>" title="" target="_blank" <% if(!!this.image) {%> <% } else {%> class="<%=this.colorBlock || "" %>" <% } %>                        <% if(this.isThumbImge(this.image)) {%>style="background-color:#fff;"<% } %>>                        <% if(!!this.image) {%>                            <% if(this.isThumbImge(this.image)) {%>                                <p class="thumb" style="background-image:url(<%= this.image%>);"></p>                            <% } else {%>                                <img src="<%= this.image %>" alt="<%=this.title || "" %>">                            <% } %>                        <% } else { %>                             <div colorBlock="<%=this.colorBlock || "" %>" class="color-block"><%=this.title || "" %></div>                        <% } %>                    </a>                    <div class="function">                        <strong class="title"><%=this.title || "" %></strong>                        <% if(this.isThumbImge(this.image)) {%><button class="refresh">×</button><% } %>                        <button class="edit"></button>                        <button class="delete"></button>                    </div>                </li>',empty_grid_html:'<li class="top grid"><a class="empty">&nbsp;</a></li>',add_grid:'<li class="grid top"><a class="add" href="javascript:void(0);"><i class="sprite sprite-circle"></i></a></li>'};grid.tranData=function(e){if(e.image||e.colorBlock){if(e.image&&(delete e.colorBlock,e.image=e.image.replace(/^http:\/\//,"https://"),!e.image.match(/^mx:\/\/thumbs\/\?/)&&!e.image.match(/^https?:\/\/fastdail-img/))){var i;if(e.sq_img||e.re_img)i=e.isHot===!0?e.sq_img:e.re_img;else{var t=e.image.match(/(?:Re|Sq)\/(.+(\.jpg|png|gif)+)(?:\.webp)?/);i=t?t[1]:"offline.png"}window.Api.Tools.isSupportWebp()&&(i+=".webp"),(e.sq_md5sum||e.re_md5sum)&&(i+="?md5="+(e.isHot===!0?e.sq_md5sum:e.re_md5sum)),e.image=cdnServer+"/image/logo/"+(e.isHot===!0?"Sq/":"Re/")+i}}else e.colorBlock="color-block-"+(parseInt(9*Math.random(),10)+1);return e},grid.render=function(e,i){return template(e,grid.tranData(i))},$(function(){function e(){o[0]&&(document.body.removeChild(o[0]),o=null)}function i(e){r&&(r.addLastGridThumbnailNode(),r.container.removeClass("show"),a.close(),r=null,e&&setTimeout(function(){e()},h))}function t(e,i){var t=this;t.uiindex=i;for(var n in e)t[n]=e[n]}function n(){return{top:document.body.scrollTop+document.documentElement.scrollTop,left:document.body.scrollLeft}}var o,r,d,a,l,s=window.Api,u=s.Maxthon,c=[],p={},g={},m={},h=300;t.prototype=function(){function t(){var e,i=this.getGridFixed(),t=n();return e=this.node.clone(),e.css({left:i.left+t.left,top:i.top+t.top,width:i.width,height:i.height}),document.body.appendChild(e[0]),e}function s(e,i){var t="";e=grid.tranData(e),e.image?e.image.startWith("mx://thumbs")?t+='<div class="thumbnail loading" url="'+e.url+'"></div>':(t+='<div class="thumbnail" ',t+='   style="background-image: url('+e.image+')">',t+="</div>"):(t+='<div class="thumbnail '+e.colorBlock+'">',t+="   <span>"+e.title+"</span>",t+="</div>");var n=$(t)[0];return i&&i.appendChild(n),n}function p(e,i){if(e||this.children){var t,n=this,e=e||n.list_node,i=i||n.children,o=i.length;for(e.innerHTML="",n.thumburls=[],t=0;(o>4?4:o)>t;t++)n.addGridThumbnailNode(i[t],e),n.thumburls.push(i[t].url);0!==n.thumburls.length&&setTimeout(function(){window.Api.Tools.isThumbExists(n.thumburls,function(e){var i=n.list_node.childNodes;e.forEach(function(e,t){var o=i[t];if(e===!0&&-1!==o.className.indexOf("loading")){var r=n.thumburls[t];o.className="thumbnail",o.style.cssText="background-image : url("+newWin.getThumbsUrl(r,0)+")"}})})},10)}}function v(e){var i,t,n,o,r,d,a,l,s=g;if(this.isHot===!0)i=8,e=e||this.topuiindex,r=J.floor(e/i),d=e%i,t=.125*s.top_container_width,a=t*d,l=0;else if(e=e||this.uiindex,!this.children&&this.group)t=153,n=11.256,o=330*.02,i=5,r=J.floor(e/i),d=e%i,a=(t+2*n)*d,l=(.7*t+o)*r;else{var u=s.container_width;u>0&&(i=6,t=.15*u,n=.008*u,o=.01*u,r=J.floor(e/i),d=e%i,grid_top=(.7*t+o)*r,a=(t+2*n)*d,l=grid_top)}return{left:a,top:l}}function b(e){var i=this.getGridPosition(e);this.node.css({left:i.left+"px",top:i.top+"px"})}function w(){this.node.find(".thumb").css({"background-image":"url("+newWin.getThumbsUrl(this.url,0)+")"}),this.node.removeClass("loading")}function x(e,t,n){var o=[],d=u.max_version;if(e.children){var a=e.children;o="1.5.50.3200"===d||d.cmpVersions("5.0.2.700")>=0?[{id:"open-all-tab",label:Language.getLang("NewTabOpenAll")},{id:"delete-tab",label:Language.getLang("Delete")},{type:!0},{id:"open-all-newwin-tab",label:Language.getLang("NewWindowOpenAll")},{id:"open-all-invisible-tab",label:Language.getLang("NewInvisibleOpenAll")}]:[{id:"delete-tab",label:Language.getLang("Delete")}],Menu.showPopupMenu(t,n,o,function(i){var t=[];switch(a.forEach(function(e){t.push(e.url)}),i){case"open-all-tab":u.useApi("openUrl",{urls:t,mode:"BackgroundTab"});break;case"delete-tab":C(e);break;case"open-all-newwin-tab":u.useApi("openUrl",{urls:t,mode:"NewWindow"});break;case"open-all-invisible-tab":u.useApi("openUrl",{urls:t,mode:"NewPrivateWindow"})}})}else o=[{id:"open-tab",label:Language.getLang("NewTabOpen")},{id:"edit-tab",label:Language.getLang("Edit")},{id:"delete-tab",label:Language.getLang("Delete")}],("1.5.50.3200"===d||d.cmpVersions("5.0.2.700")>=0)&&o.push.apply(o,[{type:!0},{id:"open-newwin-tab",label:Language.getLang("NewWindowOpen")},{id:"open-invisible-tab",label:Language.getLang("NewInvisibleOpen")}]),Menu.showPopupMenu(t,n,o,function(t){switch(t){case"open-tab":u.useApi("newTabBackground",{url:e.url}),_(e);break;case"edit-tab":k(e);break;case"delete-tab":C(e);break;case"open-newwin-tab":u.useApi("openUrl",{url:e.url,mode:"NewWindow"}),_(e),r&&i();break;case"open-invisible-tab":u.useApi("openUrl",{url:e.url,mode:"NewPrivateWindow"}),_(e),r&&i()}})}function _(e){"https://www.baidu.com/index.php?tn=maxthon2&ch=2"===e.url&&window.Api.statistic.webSend({m:"mx5Commerciallink",n:"baidu",data:{title:"MX5新标签页百度站点",url:"https://www.baidu.com/index.php?tn=maxthon2&ch=2"}})}function G(e){if(!e.group||""===e.group){var t={m:"zoneClick",data:{title:e.title,url:e.url,position:e.isHot?e.topuiindex:e.uiindex}};t.n=e.isHot===!0?"top":"myfav",datacode&&datacode.statistic(t),_(e)}return e.isHot===!0&&u.useApi("common.reportLVTAction",{action:"p-mx5Newtab_addTop8"}),e.url&&e.url.startWith("mx://note/?id")?(u.useApi("note.openNoteInPopWindow",{pid:e.url.getQueryString("pid"),id:e.url.getQueryString("id")},function(e){0!==e&&(a&&a.close(),window.Api.Tools.showNoteNotFound(e))}),!1):(e.url.match(/^file:\/\/.*/)||e.url.match(/^mx:\/\/.*/)?setTimeout(function(){u.useApi("newTabUpground",{url:e.url})},0):window.location.href=e.url,void(r&&i()))}function T(){var e=this;e.container&&(r=e,d.val(r.getGroupName()),$group_list.find(".grid-list-container").removeClass("show"),r.container.addClass("show"),a=$group_dialog.dialog({init:function(){var e=[],i=[];r.children.forEach(function(t){return t.node.hasClass("loading")?(e.push(t.url),void i.push(t)):!0}),window.Api.Tools.isThumbExists(e,function(e){e.forEach(function(e,t){e===!0&&i[t].reload()})})},close:function(){return $group_dialog.attr("edit",!1),r&&(r=null),!0}}))}function C(e){var i=e;return i.children?void window.Api.Tools.showDeleteFolder(i):(f.onRemoveGrid(i.index),void datacode.removeGrid(e))}function k(e){var i,t=e,n=r;e.group&&""!==e.group&&a&&(a.close(),$group_dialog.attr("edit",!0),i=!0,r=n),newWin.showDialog({index:t.index,uiinde:t.topuiindex||t.uiindex,title:t.title,url:t.url,image:t.image,colorBlock:t.colorBlock,group:t.group},!0,i)}function L(e){e.node.addClass("loading"),window.Api.Tools.reflushThumb(e.url)}function N(){var e=this.node[0].getBoundingClientRect();return{left:e.left,right:e.right,width:e.width,height:e.height,top:e.top,bottom:e.bottom}}function A(e,i){var t,o,r=n();if(i.top+=r.top,i.bottom+=r.top,i.left+=r.left,i.right+=r.left,e.left>i.right||i.left>e.right||e.top>i.bottom||i.top>e.bottom)return 0;t=e.left>i.left?i.right-e.left:e.right-i.left,o=e.top>i.top?i.bottom-e.top:e.bottom-i.top;var d=e.width*e.height,a=i.width*i.height;return g.area=a>d?d:a,t*o/g.area}function y(e){var i=0,t=0,n=$group_dialog.find(".dialog-warp").offset(),o={top:n.top,left:n.left,right:n.left+948,bottom:n.top+440};return e.left-o.right>i||e.right-o.left<i||e.top-o.bottom>t||e.bottom-o.top<i?!0:!1}function H(e){m.top=document.body.scrollTop+document.documentElement.scrollTop,m.bottom=m.top+document.documentElement.clientHeight;var i=m.top+10-e.top,t=e.bottom-m.bottom+10;if(i>0)Y?K.addHeight(i/2):(K.up(e),Y=!0);else if(t>0&&e.top<m.height)Y?K.addHeight(t/2):(K.down(e),Y=!0);else{if(!Y)return;K.stop(),Y=!1}}function E(){V&&clearTimeout(V),R=!0,V=setTimeout(function(){R=!1},h)}function I(e,i){var t;return t=i.index}function j(e){var i,t,n=0;for(t=r?r.children:c,i=t.length;i>n&&("Add"===t[n].title||"Empty"===t[n].title||e(t[n],n)!==!1);n++);}function D(e,i){return e.isHot===!0&&i.isHot!==!0||e.isHot!==!0&&i.isHot===!0}function S(e){if(H(e),!R){var i,t,n;if(O.children)i=O.children,j(function(i,n){return n!==O.uiindex&&!D(O,i)&&(t=A(e,i.getGridFixed()),t>Q)?(E(),f.onMovingGrid(O.index,i.index,""),!1):void 0});else if(U)t=A(e,U.getGridFixed()),D(O,U)?t>Q?o.addClass("swap"):(o.removeClass("swap"),U.removeClass("combo"),U.removeClass("current"),U=null):(t>Q&&(E(),f.onMovingGrid(O.index,U.index,O.group)),(z>t||t>Q)&&(U.removeClass("combo"),U=null));else if(r){if(y(e))return E(),l&&(n=l),void f.onMovingGrid(O.index,n.index,O.group);j(function(i,t){return t!==O.uiindex&&A(e,i.getGridFixed())>Q?(E(),f.onMovingGroup(O.index,i.index,O.group),!1):void 0})}else j(function(i,n){if(n!==O.uiindex&&(t=A(e,i.getGridFixed()),t>z)){if(U=i,D(O,U))U.addClass("current");else{if(t>Q)return E(),f.onMovingGrid(O.index,i.index,O.group),!1;U.addClass("combo")}return!1}})}}function M(){return grid.render(this.isHot===!0?grid.hot_grid_html:grid.grid_html,this)}function W(){function i(e){if(0===e.button&&!N.node.hasClass("loading")&&!o){var i=N.getGridFixed();g=i.left,m=i.top,v=e.clientX,b=e.clientY,document.addEventListener("mousemove",t,!1),document.addEventListener("mouseup",a,!1)}}function t(e){if(0!==J.abs(e.clientX-v)&&0!==J.abs(e.clientY-b)){var i=n(),t=g+i.left+e.clientX-v,r=m+i.top+e.clientY-b,d=s.width(),a=s.innerHeight(),l={left:t,right:t+d,top:r,bottom:r+a,width:d,height:a};w||(s.addClass("notran"),o=N.cloneGridNode(),O=N,w=!0,H(l),setTimeout(function(){o.addClass("notran")},20),s.addClass("draging"),o.css({padding:"0",margin:"0","z-index":"999"})),o.css({left:t,top:r}),S(l)}}function d(){var i=N.getGridFixed(),t=n();o.removeClass("notran"),o.css({left:i.left+t.left,top:i.top+t.top}),setTimeout(function(){s.removeClass("draging"),setTimeout(function(){s.removeClass("notran"),e()},20)},h)}function a(){if(Y&&(Y=!1,K.stop()),document.removeEventListener("mousemove",t,!1),document.removeEventListener("mouseup",a,!1),w)if(w=!1,T&&clearTimeout(T),!U||r)d();else{if(U.removeClass("combo"),X&&clearTimeout(X),D(O,U)){if(O.children||U.children)return d(),U.removeClass("current"),void(U=null);f.onSwappingGrid(O.index,I(O,U))}else if(O.isHot===!0&&U.isHot===!0)d();else if(U.children){var e=U.children;f.onMovingInGroup(O.index,e[e.length-(O.uiindex>U.uiindex?1:1)].index,U.title)}else f.onAddGroup(O.index,U.index,Language.getLang("NewFolder"));U=null}}var s,c,p,g,m,v,b,w,T,N=this;return N.url||N.children?(N.children?(N.group=N.title,s=$('<li class="main grid group"></li>'),p=$('<div class="thumbnail-container"></div>'),c=$(['<div class="function">','<strong class="title">',N.group,"</strong>",'<button class="delete">×</button>',"</div>"].join("")),N.addLastGridThumbnailNode(p[0],N.children),s.append(p),s.append(c),N.list_node=p[0],N.function_node=c[0],N.list_node.addEventListener("click",function(e){0===e.button&&N.showGroup()}),N.function_node.addEventListener("click",function(e){var i=$(e.target);if(i.is("button")){var t=i.prop("className");switch(t){case"delete":C(N);break;case"edit":k(N);break;case"refresh":L(N)}return!1}})):(s=$(N.html()),s.on("click",function(e){e.stopPropagation();var i=$(e.target);if(i.is("button")){var t=i.prop("className");switch(t){case"delete":C(N);break;case"edit":k(N);break;case"refresh":L(N)}return!1}return u.max_version.cmpVersions("5.0.1.1600")>0?(G(N),!1):!0}),N.image&&N.image.startWith("mx://thumbs")&&(s.addClass("loading"),window.Api.Tools.isThumbExists([N.url],function(e){e.forEach(function(e){e===!0?N.node.removeClass("loading"):window.Api.Tools.reflushThumb(N.url)})}))),s.on("mousedown",function(e){e.stopPropagation(),e.preventDefault(),i(e),1===e.button&&_(N)}),s.on("contextmenu",function(e){x(N,e.clientX,e.clientY),e.stopPropagation(),e.preventDefault()})):(N.isHot===!0?s=$("Add"===N.title?grid.add_grid:grid.empty_grid_html):(s=$(grid.add_grid.replace("top","main add")),l=N),s.on("click",".add",function(){newWin.showDialog({index:N.index,uiindex:N.topuiindex||N.uiindex},!1)})),N.node=s,N.locate(),s}function B(e){this.node.addClass(e)}function F(e){this.node.removeClass(e)}function P(){return this.group}function q(e){var i=this,t=i.children;i.group=e,t&&(t.forEach(function(i){i.group=e}),""!==e&&(i.function_node.firstChild.textContent=e))}var O,U,R,V,X,Y,z=.2,Q=.8,J=window.Math,K=function(){function e(e){d=e,a=p.offsetHeight,l=p.scrollTop(),u=g*d}function i(){R=!0,c=setInterval(function(){l=p.scrollTop(),l+=u,p.scrollTop(l),(u>0&&l+a>=s||0>u&&0>=l)&&o()},m)}function t(){o(),e(-1),i()}function n(){o(),e(1),i()}function o(){c&&clearTimeout(c),R=!1}function r(e){u=(g+e)*d}var d,a,l,s,u,c,p=$(document),g=5,m=15;return{up:t,stop:o,down:n,addHeight:r}}();return{dom:W,html:M,locate:b,reload:w,addClass:B,removeClass:F,getGroupName:P,setGroupName:q,showGroup:T,showDelete:C,getGridPosition:v,getGridFixed:N,cloneGridNode:t,addGridThumbnailNode:s,addLastGridThumbnailNode:p}}();var f=function(){function a(){S=$(".nav-body"),$grid_container=$("#grid_list_container"),$group_dialog=$("#group"),$top_container=$("#top"),$add_grid=$("#add-grid"),$group_list=$("#group_list"),$grid_container.empty(),$top_container.empty(),d=$("#group-title"),d.on("click",function(e){e.stopPropagation(),d.hasClass("editable")||(d.addClass("editable"),this.focus(),document.onkeydown=function(e){return 13===e.keyCode?(d.removeClass("editable"),!1):!0})}),d.on("blur",function(){var e=this.value.trim(),i=e.replace(/[^\x00-\xff]/g,"**").length;0===i&&(e=Language.getLang("NewFolder")),i>20&&(e=e.substring(0,20));var t=r.getGroupName();if(""===e||e===t)this.value=t;else{var n=r.children;N(r.index,n[n.length-1].index,e)}Menu.hideAndRemovePopupMenu(),d.removeClass("editable")}),g.top_container_width=$top_container.width(),g.container_width=S.width(),g.height=.15*g.container_width*.7+.01*g.container_width}function f(){g.top_container_width=$top_container.width(),g.container_width=S.width(),T()}function v(e){var i=[],t=0;c=[],e.forEach(function(e){if(e){if("Add"===e.title||"Empty"===e.title)return!0;e.group&&delete e.group,e.uiindex&&delete e.uiindex,e.isHot===!0?(e.topuiindex=t++,i.push(e)):(e.children&&e.children.forEach(function(i,t){return i?void 0:(e.children.splice(t,1),!0)}),c.push(e))}});var n=c.length-1;c.length>0&&"Add"===c[n].title&&c[n].type?c.push.apply(c,b(i)):(c.push({title:"Add",type:"button"}),c.push.apply(c,b(i)),u.setSyncValue(MY_SITE,c))}function b(e){var i=e.length;if(8>i){e.push({title:"Add",isHot:!0,topuiindex:i});for(var t=0;8-i>t;t++)e.push({title:"Empty",isHot:!0,topuiindex:i+1+t})}else e.splice(8);return e}function w(e){p[e.url]&&(e.sq_img=p[e.url].sq_img||"offline.png",e.re_img=p[e.url].re_img||"offline.png",e.re_md5sum=p[e.url].re_md5sum||"",e.sq_md5sum=p[e.url].sq_md5sum||"")}function x(e){var i;p=e,c.forEach(function(e,n){e.children?(i=new t(e,n),i.container=$('<div class="grid-list-container"></div>'),i.children=[],e.children.forEach(function(e,n){e.group=i.title,e=new t(e,n),w(e),i.container.append(e.dom()),i.children[n]=e}),$group_list.append(i.container),$grid_container.append(i.dom()),e=i):(e=new t(e,n),w(e),e.isHot===!0?$top_container.append(e.dom()):$grid_container.append(e.dom())),e.index=n,c[n]=e})}function _(e,i,t){var o=8,r=12,d=n();i>1&&(o+=50),i%2==1&&(r+=72),o+=t.top+d.top,r+=t.left+d.left,e.removeClass("notran"),setTimeout(function(){e.addClass("small"),setTimeout(function(){e[0].style.cssText="left:"+r+"px; top: "+o+"px; width:71px; height: 46px;"},5)},5)}function G(e,i){a(),v(e),x(i),T()}function T(){var e,i=0,t=0,n=g.height;c.forEach(function(n,o){if(n.uiindex=o,n.isHot===!0){if(t>7)return n.node.remove(),c.splice(o,1),!1;n.topuiindex=t++}n.locate(),e=n.children,e&&e.forEach(function(e,t){e.uiindex=t,e.locate(t),e.index=e.url?i++:i}),n.index=i++}),$grid_container[0].style.height=c[c.length-9].getGridPosition().top+n+"px",m.height=document.body.scrollHeight}function C(e){if(0!==e&&!e)return{grid:l,i:-1,j:-1};var i,t,n,o,r=0,d=-1,a=c.length;e:for(;a>r;r++){if(t=c[r],t.index==e){i=t;break}if(t.children){for(d=0,o=t.children.length;o>d;d++)if(n=t.children[d],n.index==e){i=n;break e}d=-1}}return i?{grid:i,i:r,j:d}:!1}function k(e,t,n){var o,r,d=C(e),a=C(t),l=d.grid,s=a.grid;d.j>=0&&(o=c[d.i]),a.j>=0&&(r=c[a.i]),l.group&&""!==l.group?""==n?(c.splice(a.i,0,c.splice(d.i,1)[0]),datacode.moveGrid(l.isHot,s.isHot)):(delete l.group,c.splice(a.i,0,o.children.splice(d.j,1)[0]),0===o.children.length?(c.splice(d.i,1),o.node.remove()):(o.container[0].removeChild(l.node[0]),o.addLastGridThumbnailNode()),$grid_container.append(l.node),i()):(c.splice(a.i,0,c.splice(d.i,1)[0]),datacode.moveGrid(l.isHot,s.isHot)),window.Api.Grid.moveGridItem({i:d.i,j:d.j},{i:a.i,j:a.j}),T()}function L(e,i){var t,n,o=C(e),d=C(i);o.j>=0&&(t=c[o.i]),d.j>=0&&(n=c[d.i]),r.children.splice(d.j,0,r.children.splice(o.j,1)[0]),t.addLastGridThumbnailNode(),window.Api.Grid.moveGridItem({i:o.i,j:o.j},{i:d.i,j:d.j}),T(),datacode.moveGrid(!1,!1)}function N(e,i,t){var n=C(e),n=c[n.i];n.title=t,n.setGroupName(t),clearTimeout(M),M=setTimeout(function(){window.Api.Grid.updateGridGroup(n.uiindex,t)},h)}function A(i,t,n){{var d,a,l,s=C(i),u=C(t),p=s.grid;u.grid}if(s.j>=0&&(d=c[s.i]),u.j>=0&&(a=c[u.i]),p.setGroupName(n),a.children.splice(a.children.length,0,c.splice(s.i,1)[0]),$grid_container[0].removeChild(p.node[0]),a.container.append(p.node),o&&!r){p.removeClass("draging"),p.removeClass("notran"),l=a.children.length-1;var g=a.getGridFixed();_(o,l,g),setTimeout(function(){a.addLastGridThumbnailNode(),window.Api.Grid.insertGridItem(s.i,u.i),T(),e()},h)}datacode.moveGrid(!1,!1)}function y(i,n,r){var d,a,l,s=C(i),u=s.grid,p=C(n),g=p.grid,m=p.i+(i>n?0:-1),f=new t({title:r,container:$('<div class="grid-list-container"></div>'),children:[]},m);d=f.children,i>n?(d[1]=c.splice(s.i,1)[0],d[0]=c.splice(p.i,1)[0]):(d[0]=c.splice(p.i,1)[0],d[1]=c.splice(s.i,1)[0]),o&&(l=g.getGridFixed(),a=g.cloneGridNode(),a.css({padding:0,margin:0,overflow:"hidden"}));var v=f.dom();v.css({"z-index":"-100"}),$grid_container.append(v),$group_list.append(f.container),c.splice(m,0,f),f.setGroupName(r),$grid_container[0].removeChild(g.node[0]),$grid_container[0].removeChild(u.node[0]),f.container.append(g.node),f.container.append(u.node),u.removeClass("draging"),u.removeClass("notran"),o&&(_(a,0,l),_(o,1,l),setTimeout(function(){v.removeAttr("style"),window.Api.Grid.addGridGroup(m,s.i,p.i,r),T(),e(),a.remove()},h-150)),datacode.createFolder({})}function H(i,r){var d,a,l,s,u,p,p,g=C(i),m=g.grid,f=C(r),v=f.grid,b=n();o&&(o.removeClass("notran"),a=v.getGridFixed(),d=v.cloneGridNode(),d.css({padding:0,margin:0,overflow:"hidden"})),l=m.getGridFixed(),d.css({left:l.left+b.left,top:l.top+b.top}),o.css({left:a.left+b.left,top:a.top+b.top}),p=$.extend({},v),dragData=$.extend({},m),m.isHot===!0?(p.isHot=!0,p.topuiindex=m.topuiindex,dragData.isHot=!1,delete dragData.topuiindex,dragData.uiindex=v.uiindex):(dragData.isHot=!0,dragData.topuiindex=v.topuiindex,p.isHot=!1,delete p.topuiindex,p.uiindex=m.uiindex),s=new t(p,m.uiindex),m.node.replaceWith(s.dom().addClass("draging")),u=new t(dragData,v.uiindex),v.node.replaceWith(u.dom().addClass("draging")),c.splice(g.i,1,s),c.splice(f.i,1,u),m.removeClass("draging"),m.removeClass("notran"),o&&setTimeout(function(){u.node.removeClass("draging"),s.node.removeClass("draging"),window.Api.Grid.swapGridItem(g.i,E(p),f.i,E(dragData)),T(),e(),d.remove(),datacode.moveGrid(!0,!1)},h)}function E(e){var i={title:e.title,image:e.image,url:e.url,isHot:e.isHot};return i.image||(delete i.image,i.colorBlock=e.colorBlock),i}function I(e,i){var n,o,r,d=i||l;o=c,n=d.uiindex,d.isHot===!0&&(e.topuiindex=d.topuiindex),e.uiindex=n,r=new t(e,n),o.splice(n,0,r),d.node.parent().append(r.dom()),window.Api.Grid.insertGridItem(n,-1,E(e)),T()}function j(e){var i,n,o=C(e.index),r=o.i,d=o.j;0>d?(e.isHot===!0&&(e.topuiindex=o.grid.topuiindex),n=new t(e,r),i=c[r].node.parent(),c[r]=n,n.uiindex=r):(e.group=o.grid.group,n=new t(e,d),c[r].children[d]=n,n.uiindex=d,i=c[r].container,c[r].addLastGridThumbnailNode()),i.append(n.dom()),o.grid.node.remove(),T(),window.Api.Grid.updateGridItem(r,d,E(e))}function D(e){var n,o=C(e),r=o.grid,d=o.i,a=o.j;r.addClass("remove"),setTimeout(function(){if(r.node.remove(),0>a){if(c.splice(d,1),r.isHot===!0){var e,o=c.length,l=c[o-1];e=l.url||"Add"!==l.title&&"Empty"!==l.title?new t({title:"Add",isHot:!0},o):new t({title:"Empty",isHot:!0},o),e.topuiindex=r.topuiindex,c.splice(o,0,e),$top_container.append(e.dom())}}else n=c[d],n.children.splice(a,1),n.children&&0===n.children.length?(c.splice(d,1),n.node.remove(),i()):n.addLastGridThumbnailNode();window.Api.Grid.removeGridItem(d,a),T()},h)}var S;window.addEventListener("resize",s.Tools.throttle(f,100,300),!1);var M;return{getGridItem:C,onAddGroup:y,onRemoveGrid:D,onMovingGrid:k,onMovingInGroup:A,onGetGridList:G,onMovingGroup:L,onSwappingGrid:H,onInsertGridItem:I,onUpdateGridItem:j,onSetGroupName:N}}(),v=!1;u.useApi("quickaccess.addEventListener",{},function(e){if(!$.isEmptyObject(e))switch(console.log(e),e.type){case"thumbUpdated":var i=e.data;setTimeout(function(e){for(var i=0;i<c.length;i++){var t=c[i];if(t.node.hasClass("loading")&&e===t.url){t.reload();break}if(t.children&&t.children.length>0)for(var n=t.children,o=t.list_node.childNodes,r=Math.min(n.length,4),d=0;r>d;d++){var a=o[d];if(t=n[d],-1!==a.className.indexOf("loading")&&e===t.url){a.className="thumbnail",a.style.cssText="background-image : url("+newWin.getThumbsUrl(t.url,0)+")";break}}}},0,i);break;case"guestSuccess":s.Grid.getGridDataList();break;case"guest5Success":s.Grid.getGridDataList();break;case"dataSyncCompleted":if(u.max_version.cmpVersions("5.0.3.400")>0)return void s.Grid.getGridDataList();v||(v=!0,s.Grid.getGridDataList());break;case"addNewSite":var t={url:e.url,title:e.title},n=/.*\:\/\/([^\/]*).*/,o=t.url.match(n),r="";if("undefined"!=typeof o&&null!=o&&(r=o[1]),""!==r)e:for(var d=0;d<SITE_LIST.length;d++)for(var a=SITE_LIST[d],l=0;l<a.list.length;l++){var p=a.list[l],g=p.url;if(g.indexOf(r)>=0){t.image=p.image,d=SITE_LIST.length;break e}if(p.match)for(var m=0;m<p.match.length;m++){var h=p.match[m];if(h.indexOf(r)>=0){t.image=p.image,d=SITE_LIST.length;break e}}}t.image||(t.image="mx://thumbs/?reflush=0&stamp="+(new Date).getTime()+"&url="+t.url),f.onInsertGridItem(t),datacode.statistic({m:"sendintoqa",data:{title:t.title,href:t.href}})}}),window.Controller=f,window.Api.dialog=function(){function e(){a.close()}return{close:e}}()});