"use strict";$(function(){var e=function(){function e(){t()}function t(){$config_layer=$("#config-layer"),g=$("#config-button"),u=$config_layer.find(".skin-img-list"),p=$config_layer.find(".skin-img-list"),v=[{pic:"light.jpg",type:"picture",brightness:"dark",data_code:"defaultlight"},{pic:"deep.jpg",type:"picture",brightness:"light",data_code:"defaultdark"},{pic:"harbor.jpg",type:"video",brightness:"light",data_code:"harbor",play:!0},{pic:"sunny.jpg",type:"video",brightness:"light",data_code:"sunny",play:!0},{pic:"yun.jpg",type:"video",brightness:"dark",data_code:"clouds",play:!0},{pic:"moonlight.jpg",type:"video",brightness:"light",data_code:"moonlight",play:!0},{pic:"mountains.jpg",type:"video",brightness:"dark",data_code:"mountains",play:!0},{pic:"sky.jpg",type:"picture",brightness:"light",data_code:"sky"},{pic:"dandelion.jpg",type:"picture",brightness:"dark",data_code:"bridge"},{pic:"sundown.jpg",type:"picture",brightness:"dark",data_code:"dandelion"},{pic:"bridge.jpg",type:"picture",brightness:"dark",data_code:"sundown"},{pic:"old.jpg",type:"picture",brightness:"dark",data_code:"old"},{pic:"night.jpg",type:"picture",brightness:"light",data_code:"night"},{pic:"balloon.jpg",type:"picture",brightness:"light",data_code:"balloon"}],b.cmpVersions("5.0.4.400")<0&&(v.splice(2,5),v.splice(v.length-1,1)),b.cmpVersions("5.0.3.400")<0&&$config_layer.find(".tips").remove()&&$config_layer.find(".a-upload").height(0);var e=[];v.forEach(function(t){e.push('<li class="skin-img-item" name="'+t.data_code+'">'),e.push(' <a href="javascript:void(0);">'),e.push('     <img class="skin-img-item-img" src="'+r(t.pic,!0)+'" />'),"video"===t.type&&e.push('     <div class="operate-button loading"></div>     '),e.push(" </a>"),e.push("</li>")}),p.empty().append(e.join("")),h.addEventListener("play",function(){$config_layer.find(".operate-button").removeClass("start").removeClass("loading").addClass("pause")}),h.addEventListener("error",function(){$config_layer.find(".operate-button").addClass("start")}),h.addEventListener("pause",function(){$config_layer.find(".operate-button").removeClass("pause").removeClass("loading").addClass("start")}),s(function(e){m=e;var t=localStorage.getItem("CUSTOM_BACKGROUND");if(t&&t.length&&(m.bgIndex=-1,m.customBackground=t),-1===m.bgIndex&&m.customBackground){var s=new Image;s.onload=function(){n(m.customBackground),o(),c()},s.onerror=function(){m.bgIndex=4,a(m.bgIndex,v[m.bgIndex].pic),o(v[m.bgIndex].brightness),c()},s.src=m.customBackground}else{var d=v[m.bgIndex];d||(d=v[0]),"picture"===d.type?n(r(d.pic,!1)):a(m.bgIndex,d.pic),p.find(">li").removeClass("selected").eq(m.bgIndex).addClass("selected"),o(d.brightness)}skinDisplay&&skinDisplay===!0&&(localStorage.setItem("BODY_CLASS_NAME",document.body.className),document.body.className="",document.getElementById("skin").style.display="block",document.getElementById("siderbar").style.display="none"),i()})}function i(){function e(e){var i=e.target.webkitHidden;i?h.paused||(h.pause(),t=!0):t===!0&&h.paused&&(h.play(),t=!1)}$config_layer.find(".upload").on("click",function(){y.useApi("quickaccess.selectBgImage",{},function(e){if(e&&e.succeed===!0){var t="mx://newtab/user_custom_bg_image.png?v="+(new Date).getTime();m.bgIndex=-1,m.customBackground=t,c(),n(t),o(),p.find(">li").removeClass("selected")}})}),g.on("click",function(){$config_layer.css({right:"0px"}),$("#mx_mask_layer").show().unbind("click").click(function(){$config_layer.removeAttr("style"),$(this).hide()}),window.onresize=function(){this.resizeTimer&&clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(function(){u.height(window.innerHeight-120)},100)},setTimeout(function(){window.onresize()},50)}),$config_layer.on("click",".close",function(){$config_layer.removeAttr("style"),$("#mx_mask_layer").hide().unbind("click"),window.onresize=null}),p.on("click","li",function(e){var t=$(this);if(!t.hasClass("selected")&&!$(e.target).hasClass("operate-button")){t.siblings("li").removeClass("selected"),t.addClass("selected");var i=t.index(),s=v[i];localStorage.removeItem("CUSTOM_BACKGROUND"),"picture"===s.type?n(r(s.pic,!1)):a(i,s.pic),delete m.play,o(s.brightness),m.bgIndex=i,m.customBackground&&delete m.customBackground,c(m),datacode&&datacode.statistic({n:s.data_code,m:"switchbackground"})}}),$config_layer.on("click",".operate-button",function(e){if(e.stopPropagation(),3===h.networkState)return void h.load();m.bgIndex;h.paused?(h.play(),m.play=!0):(h.pause(),m.play=!1),c(m)});var t=!1;document.addEventListener("webkitvisibilitychange",e,!1)}function n(e){f.css({"background-image":"url("+e+")"}),h.removeAttribute("src"),h.removeAttribute("poster"),h.style.display="none",m&&delete m.play}function a(e,t){h.poster=t.replace(/([A-Za-z]+).jpg/,function(e,t){return staticServer+"/img/bg/"+t+".jpg"}),h.src=t.replace(/([A-Za-z]+).jpg/,function(e,t){return staticServer+"/img/bg/video/"+t+".mp4"});var i=v[e].play;e===m.bgIndex&&(i=m.play===!1?!1:!0),i===!0?h.play():(h.pause(),$config_layer.find(".operate-button").removeClass("loading").addClass("start")),f.removeAttr("style"),h.style.display="block"}function o(e){var t=$("body");if(!e){if(-1===m.bgIndex)return d(m.customBackground),!1;e=v[m.bgIndex].brightness}t.attr("class",e)}function s(e){y.getSyncValue("noSyncData",function(t){(void 0===t.bgIndex||14===t.bgIndex)&&(t.bgIndex=4),e(t)})}function c(){y.setSyncValue("noSyncData",m)}function r(e,t){return staticServer+"/img/bg/"+(t?"preview/":"")+e+(window.Api.Tools.isSupportWebp()?".webp":"")}function d(e){e&&0!==e.length&&(window.RGBaster?l(e):$.getScript(staticServer+"/js/lib/rgbaster.js",function(){l(e)}))}function l(e){console.time("calc color"),RGBaster.colors(e,{success:function(e){console.timeEnd("calc color"),brightness=e.dominant<128?"light":"dark",$("body").attr("class",brightness)}})}var g,p,u,m,y=window.Api.Maxthon,b=(y.platform,y.max_version),f=$("#wallpapers"),h=document.getElementById("media"),v=[];return{init:e}}();window.configPanel=e});